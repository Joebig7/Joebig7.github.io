I"ï^<p><strong>å®šä¹‰</strong>: ä¸€ä¸ªå®ç°äº†Listæ¥å£çš„å¯è°ƒæ•´å¤§å°çš„æ•°ç»„,å®ç°äº†Listæ¥å£æ‰€æœ‰çš„å¯é€‰æ“ä½œå¹¶ä¸”å¯ä»¥å®¹çº³æ‰€æœ‰ç±»å‹çš„å¯¹è±¡åŒ…æ‹¬null,åŒæ—¶æä¾›äº†æ–¹æ³•æ¥æ”¹å˜Listå®¹é‡çš„å¤§å°ã€‚</p>

<p><strong>ç‰¹å¾</strong>:</p>
<ul>
  <li>å¯è‡ªåŠ¨æ‰©å®¹ï¼Œå’Œvectorç›¸æ¯”æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</li>
  <li>å¯ä»¥é€šè¿‡List list = Collections.synchronizedList(new ArrayList(â€¦));ç”Ÿæˆçº¿ç¨‹å®‰å…¨çš„Listå¯¹è±¡</li>
  <li>ArrayListå®ç°äº†Iteratoræ¥å£å¯ä»¥é€šè¿‡iterator()æ–¹æ³•è·å–åˆ°è¿­ä»£å™¨</li>
  <li>ç”±äºArrayListæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥å¦‚æœåŒæ—¶å®ƒè¿›è¡Œéå†å’Œè¯¥å˜å®ƒçš„å†…éƒ¨æ¥å£ä¼šthrow ConcurrentModificationExceptionã€‚ï¼ˆå¯ä»¥é€šè¿‡iteratorè§£å†³è¿™ä¸ªé—®é¢˜ï¼‰</li>
</ul>

<h2 id="å®ç°ç»“æ„å›¾">å®ç°ç»“æ„å›¾</h2>
<p><img src="https://i.imgur.com/6G5EC5r.png" alt="" /></p>

<h2 id="å…·ä½“åº•å±‚ä»£ç å®ç°">å…·ä½“åº•å±‚ä»£ç å®ç°</h2>
<h3 id="å®šä¹‰çš„ä¸€äº›å¸¸é‡">å®šä¹‰çš„ä¸€äº›å¸¸é‡</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>  /**
   * jdk1.8ä¸­ArrayListçš„é»˜è®¤å®¹é‡å¤§å°ä¸º10
   */
  private static final int DEFAULT_CAPACITY = 10;
  
  /**
   * å½“ArrayListåˆå§‹åŒ–ä¸º0æ—¶é»˜è®¤èµ‹å€¼ä¸ºè¯¥ç©ºå¯¹è±¡æ•°ç»„
   */
  private static final Object[] EMPTY_ELEMENTDATA = {};
  
   /**
   * å½“ArrayListåˆå§‹åŒ–æ—¶ä¸æŒ‡å®šå¤§å°æ—¶ä¾¯ä½¿ç”¨è¯¥å¯¹è±¡æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼ŒåŒæ—¶ç”¨æ¥åŒºåˆ†åˆå§‹åŒ–ä¸º0çš„é‚£ç§æƒ…å†µ
   */
  private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
  
  /**
   * å­˜å‚¨ArrayListå…ƒç´ çš„æ•°ç»„ç¼“å†²åŒºã€‚ArrayListå…ƒç´ çš„åº•å±‚å­˜å‚¨éƒ½æ˜¯åŸºäºè¯¥æ•°ç»„
   */
  transient Object[] elementData;

 /**
   * ç”¨æ¥è®°å½•ArrayListä¸­å…ƒç´ çš„ä¸ªæ•°
   */
  private int size;
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="å¸¸ç”¨æ–¹æ³•çš„åº•å±‚å®ç°">å¸¸ç”¨æ–¹æ³•çš„åº•å±‚å®ç°</h3>
<h4 id="é»˜è®¤æ„é€ å‡½æ•°">é»˜è®¤æ„é€ å‡½æ•°</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>   /**
    * åˆå§‹åŒ–ä¸€ä¸ªå®¹é‡ä¸º10çš„ç©ºçš„ArrayListé›†åˆ
    */
   public ArrayList(){
       this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
   }
</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="å¸¦å‚æ„é€ å‡½æ•°">å¸¦å‚æ„é€ å‡½æ•°</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre>    /**
     * å‚æ•°initialCapacityä»£è¡¨ArrayListæŒ‡å®šçš„åˆå§‹åŒ–å®¹é‡çš„å¤§å°
     * initialCapacity&gt;0 åˆå§‹åŒ–Object[] elementDataæ•°ç»„å¤§å°ä¸ºæŒ‡å®šçš„initialCapacity
     * initialCapacity=0 åˆå§‹åŒ–Object[] elementData ä¸ºç©ºæ•°ç»„EMPTY_ELEMENTDATA
     * initialCapacity&lt;0 æŠ›å‡ºå®¹é‡å¤§å°ä¸åˆæ³•çš„å¼‚å¸¸
     */
    public ArrayList(int initialCapacity) {
        if (initialCapacity &gt; 0) {
            this.elementData = new Object[initialCapacity];
        } else if (initialCapacity == 0) {
            this.elementData = EMPTY_ELEMENTDATA;
        } else {
            throw new IllegalArgumentException("Illegal Capacity: "+
                                               initialCapacity);
        }
    }


   /**
    * å‚æ•° ä»»æ„Collectionå¯¹è±¡
    * 1 å°†Collectionå¯¹è±¡è½¬æ¢æˆæ•°ç»„
    * 2 å¦‚æœè½¬æ¢æˆçš„æ•°ç»„size==0 åˆ™åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º0çš„ArrayListå¯¹è±¡ï¼Œå¦åˆ™å°†å¯¹è±¡æ•°ç»„æ‹·è´åˆ°elementDataæ•°ç»„ä¸­å»
    *        æ³¨æ„: toArray()æ–¹æ³•è¿”å›çš„å¯èƒ½ä¸æ˜¯Object[]ç±»å‹ï¼Œä¾‹å¦‚Arrays.asList("asList")åº•å±‚è¿”å›çš„å°±æ˜¯ä¸€ä¸ªString[]ç±»å‹çš„æ•°ç»„ï¼Œåªæ˜¯åŒ…è£…åœ¨List&lt;String&gt;ä¸­ã€‚ï¼Œæ‰€ä»¥è¿™è¾¹åˆ¤æ–­äº†elementData.getClass()çš„ç±»å‹ï¼Œå¦‚æœä¸æ˜¯å¯¹è±¡æ•°ç»„å°†å®ƒå‘ä¸Šè½¬å‹æˆäº†å¯¹è±¡æ•°ç»„ã€‚
    */
   public ArrayList(Collection&lt;? extends E&gt; c) {
        elementData = c.toArray();
        if ((size = elementData.length) != 0) {
            // c.toArray might (incorrectly) not return Object[] (see 6260652)
            if (elementData.getClass() != Object[].class)
                elementData = Arrays.copyOf(elementData, size, Object[].class);
        } else {
            // replace with empty array.
            this.elementData = EMPTY_ELEMENTDATA;
        }
    }
    
    
    public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) {
        @SuppressWarnings("unchecked")
        T[] copy = ((Object)newType == (Object)Object[].class)
            ? (T[]) new Object[newLength]
            : (T[]) Array.newInstance(newType.getComponentType(), newLength);
        System.arraycopy(original, 0, copy, 0,
                         Math.min(original.length, newLength));
        return copy;
    }
    
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="adde-eæ–¹æ³•-è¿”å›å€¼ä¸ºboolean">add(E e)æ–¹æ³• è¿”å›å€¼ä¸ºboolean</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
</pre></td><td class="rouge-code"><pre>    /**
     * E eä»£è¡¨å¯ä»¥æ·»åŠ çš„å‚æ•° å¦‚æœå®ä¾‹åŒ–çš„æ—¶å€™æŒ‡å®šäº†æ³›å‹ç±»å‹åˆ™åªèƒ½æ·»åŠ æŒ‡å®šç±»å‹çš„å…ƒç´ ï¼Œä¸ç„¶åˆ™ä¸ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œeå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å…ƒç´ åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨ç±»å‹æ“¦é™¤å½“æˆObjectæ¥å¤„ç†
     * æ·»åŠ å…ƒç´ åˆ°é›†åˆä¸­å»
     *
     * ensureCapacityInternal(size+1) 
     * æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ç¡®ä¿å®¹é‡è¶³å¤Ÿå¤§
     *
     * elementData[size++] = e;
     * å°†å…ƒç´ æ·»è¿½åŠ åˆ°elmentDataæ•°ç»„çš„æœ€åä¸€ä½
     *
     * è¿”å›booleanä¸ºtrue
    */ 
    public boolean add(E e) {
        ensureCapacityInternal(size + 1);  // Increments modCount!!
        elementData[size++] = e;
        return true;
    }
    
    
    /**
     * ç¡®ä¿æ·»åŠ çš„æ—¶å€™é›†åˆçš„å®¹é‡è¶³å¤Ÿå¤§
     *
     * è°ƒç”¨ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));æ–¹æ³•è¿›è¡Œæ‰©å®¹
     *
     * è°ƒç”¨calculateCapacity(elementData, minCapacity)è®¡ç®—é›†åˆéœ€è¦è¾¾åˆ°çš„æœ€å°çš„å®¹é‡
     */
    private void ensureCapacityInternal(int minCapacity) {
        ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
    }
    
    
    /**
     *  åˆ¤æ–­elementDataæ˜¯å¦ä¸ºé»˜è®¤å®¹é‡çš„æ•°ç»„ï¼Œå¦‚æœæ˜¯åˆ™é€‰å–é»˜è®¤å®¹é‡å’Œæ·»åŠ å…ƒç´ åå®¹é‡ä¸­çš„æœ€å¤§å€¼
     *  å¦‚æœä¸æ˜¯ç›´æ¥è¿”å›minCapacity(éœ€è¦è¾¾åˆ°çš„æœ€å°å®¹é‡)
     */
    private static int calculateCapacity(Object[] elementData, int minCapacity) {
        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
            return Math.max(DEFAULT_CAPACITY, minCapacity);
        }
        return minCapacity;
    }
    
    
    /**
     *  ç¡®ä¿å®¹é‡çš„å…·ä½“æ–¹æ³•
     *  
     *  modCount++; ç”¨æ¥è®°å½•æ¯ä¸€æ¬¡ç»“æ„æ€§çš„è°ƒæ•´ modCountç»§æ‰¿ä¸abstractList
     *
     *  åˆ¤æ–­æ·»åŠ å…ƒç´ åçš„å®¹é‡æ˜¯å¦å¤§äºå½“å‰é›†åˆçš„å®¹é‡ï¼Œå¦‚æœè¶…è¿‡äº†å½“å‰é›†åˆçš„å®¹é‡å°±è°ƒç”¨grow(minCapacity)è¿›è¡Œæ‰©å®¹
     */
    private void ensureExplicitCapacity(int minCapacity) {
        modCount++;

        // overflow-conscious code
        if (minCapacity - elementData.length &gt; 0)
            grow(minCapacity);
    }
    
     /**
      * å°†å®¹é‡æ‰©å±•ä¸ºå½“å‰å®¹é‡çš„1.5å€ï¼ˆåˆ©ç”¨ä½è¿ç®—ï¼‰
      * 
      * å¦‚æœæ‰©å¤§1.5åä»ç„¶æ¯”å½“å‰éœ€è¦çš„å®¹é‡å°ï¼Œå°±æ‰©å®¹è‡³minCapcityå¤§å°
      * å¦‚æœæ‰©å¤§1.5åè¶…è¿‡äº†MAX_ARRAY_SIZE è°ƒç”¨hugeCapacity(minCapacity);è·å–æŒ‡å®šå®¹é‡
      * 
      * å°†å½“å‰æ•°ç»„å¤åˆ¶ç»™æ–°çš„æ‰©å®¹åçš„æ•°ç»„ä½œä¸ºæ–°çš„é›†åˆ
      */
     private void grow(int minCapacity) {
        // overflow-conscious code
        int oldCapacity = elementData.length;
        int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);
        if (newCapacity - minCapacity &lt; 0)
            newCapacity = minCapacity;
        if (newCapacity - MAX_ARRAY_SIZE &gt; 0)
            newCapacity = hugeCapacity(minCapacity);
        // minCapacity is usually close to size, so this is a win:
        elementData = Arrays.copyOf(elementData, newCapacity);
    }
    
    
    /**
     *  å¦‚æœéœ€è¦å®¹é‡å¤§å°0 æŠ›å‡ºå¼‚å¸¸
     *  ä¸ç„¶åˆ¤æ–­æ˜¯å¦å¤§äºMAX_ARRAY_SIZE å¦‚æœå¤§äºåˆ™è¿”å›Inter.MAX_VALUE æ²¡æœ‰åˆ™è¿”å›MAX_ARRAY_SIZE
     */
    private static int hugeCapacity(int minCapacity) {
        if (minCapacity &lt; 0) // overflow
            throw new OutOfMemoryError();
        return (minCapacity &gt; MAX_ARRAY_SIZE) ?
            Integer.MAX_VALUE :
            MAX_ARRAY_SIZE;
    }

    
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="addint-index-e-elementæ–¹æ³•åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ å³å°†å½“å‰å…ƒç´ ä»¥åŠå¾€åçš„å…ƒç´ å‘åç§»åŠ¨å°†å…ƒç´ æ’å…¥è¯¥ä½ç½®">add(int index, E element)æ–¹æ³•(åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ï¼Œå³å°†å½“å‰å…ƒç´ ä»¥åŠå¾€åçš„å…ƒç´ å‘åç§»åŠ¨ï¼Œå°†å…ƒç´ æ’å…¥è¯¥ä½ç½®)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>    /**
     * 1. æ£€æŸ¥ç´¢å¼•ä½ç½®æ˜¯å¦åˆæ³• 
     * 2. ç¡®ä¿å®¹é‡è¶³å¤Ÿå¤§ï¼ˆè¿™éƒ¨å’Œadd()æ–¹æ³•åˆ¤æ–­ä¸€æ ·ï¼‰ï¼ˆè¿™æ­¥ modCount +1 å› ä¸ºæ”¹å˜äº†æ•°æ®ç»“æ„ï¼‰ ensureCapacityInternal(size + 1); 
     * 3. å°†indexåçš„å†…å®¹å‘åç§»åŠ¨ä¸€ä½System.arraycopy(elementData, index, elementData, index + 1,size - index);
     * 3. å°†å…ƒç´ æ·»åŠ åˆ°indexçš„ä½ç½® elementData[index] = element;
     * 4. size++; å…ƒç´ çš„ä¸ªæ•°åŠ ä¸€
     *
    public void add(int index, E element) {
        
         rangeCheckForAdd(index);
         // Increments modCount!!
        System.arraycopy(elementData, index, elementData, index + 1,
                         size - index);
        elementData[index] = element;
        size++;
    }

    /**
     * åˆ¤æ–­å¦‚æœç´¢å¼•æ¯”å…ƒç´ ä¸ªæ•°å¤§æˆ–è€…å°äº0 å°±æŠ›å‡ºå¼‚å¸¸ç´¢å¼•è¶…è¿‡è¾¹ç•Œçš„å¼‚å¸¸
     */
    private void rangeCheckForAdd(int index) {
        if (index &gt; size || index &lt; 0)
            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
    }
    
    
    æ³¨æ„æœ‰ä¸¤ä¸€ç§æƒ…å†µï¼Œå¦‚æœindex==sizeåˆ™è¡¨ç¤ºåœ¨å½“å‰é›†åˆçš„æœ€åæ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶å’Œadd()æ–¹æ³•æ•ˆæœä¸€æ ·ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="removeint-index-å°†æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ åˆ é™¤-è¿”å›å€¼ä¸ºè¢«åˆ é™¤çš„å…ƒç´ ">remove(int index) å°†æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ åˆ é™¤ è¿”å›å€¼ä¸ºè¢«åˆ é™¤çš„å…ƒç´ </h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre>   /**
    *  1.æ£€æŸ¥ç´¢å¼•ä½ç½®æ˜¯å¦åˆæ³• rangeCheck(index);
    *  2. modCount++; æ•°æ®ç»“æ„è¢«ä¿®æ”¹è®°å½•+1
    *  3. E oldValue = elementData(index);è·å–ç´¢å¼•ä½ç½®çš„å…ƒç´ 
    *  4. è®¡ç®—éœ€è¦å‘å‰ç§»åŠ¨çš„å…ƒç´ çš„ä¸ªæ•°ç„¶åå°†å…ƒç´ å‘å‰æ‹·è´
    *  5. å°†åŸæœ¬æœ€åä¸€ä½çš„å…ƒç´ é‡Šæ”¾ï¼ˆsize-1å¹¶ä¸”èµ‹å€¼ä¸ºnullï¼‰
    *  6. è¿”å›åˆ é™¤çš„å…ƒç´ 
    */
  
   public E remove(int index) {
        rangeCheck(index);

        modCount++;
        E oldValue = elementData(index);

        int numMoved = size - index - 1;
        if (numMoved &gt; 0)
            System.arraycopy(elementData, index+1, elementData, index,
                             numMoved);
        elementData[--size] = null; // clear to let GC do its work

        return oldValue;
    }


    /**
     * åˆ¤è¯»indexæ˜¯å¦å¤§äºç­‰äºå…ƒç´ ä¸ªæ•°ï¼Œæ»¡è¶³åˆ™æŠ›å‡ºç»å¸¸ç´¢å¼•ä½ç½®è¶Šç•Œ
     */
    private void rangeCheck(int index) {
        if (index &gt;= size)
            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
    }

    E elementData(int index) {
        return (E) elementData[index];
    }
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="removeobject-o-å°†é›†åˆä¸­æŒ‡å®šå…ƒç´ åˆ é™¤-è¿”å›å€¼ä¸ºboolean">remove(Object o) å°†é›†åˆä¸­æŒ‡å®šå…ƒç´ åˆ é™¤ è¿”å›å€¼ä¸ºboolean</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre>  /*
   * 1. åˆ†ä¸¤ç§æƒ…å†µ å¦‚æœo==null åˆ™é€šè¿‡elementData[index] == nullæŸ¥æ‰¾æ˜¯å¦å­˜ä¸ºnullçš„å…ƒç´ 
                     o!=null åˆ™é€šè¿‡o.equals(elementData[index]æŸ¥æ‰¾æ˜¯å¦å­˜ä¸ºnullçš„å…ƒç´ (è€ƒè™‘åˆ°å¯¹è±¡å’Œå€¼å¯¹äºå€¼æ¥è¯´å°±æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¯¹è±¡åˆ™éœ€è¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡åœ°å€æ‰ä¼šè¢«åˆ é™¤)
   */
   public boolean remove(Object o) {
        if (o == null) {
            for (int index = 0; index &lt; size; index++)
                if (elementData[index] == null) {
                    fastRemove(index);
                    return true;
                }
        } else {
            for (int index = 0; index &lt; size; index++)
                if (o.equals(elementData[index])) {
                    fastRemove(index);
                    return true;
                }
        }
        return false;
    }
    
    
    /**
     * 1.modCount++ ä¿®æ”¹äº†é›†åˆçš„æ•°æ®ç»“æ„
     * 2.è®¡ç®—éœ€è¦å‘å‰ç§»åŠ¨çš„å…ƒç´ çš„æ•°é‡
     * 3.æ‹·è´å…ƒç´ 
     * 4.å°†åŸæœ¬æœ€åä¸€ä½å…ƒç´ èµ‹å€¼ä¸ºnull
     
     * æ³¨æ„ æ­¤å¤„åˆ é™¤å¹¶æ²¡æœ‰æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆæ³• å› ä¸ºåªæœ‰å…ƒç´ å­˜åœ¨æ‰ä¼šè¿›è¡Œè¿™ä¸€æ­¥ç´¢å¼•ä¿è¯äº†ç´¢å¼•çš„åˆæ³•æ€§
     */
    private void fastRemove(int index) {
        modCount++;
        int numMoved = size - index - 1;
        if (numMoved &gt; 0)
            System.arraycopy(elementData, index+1, elementData, index,
                             numMoved);
        elementData[--size] = null; // clear to let GC do its work
    }

</pre></td></tr></tbody></table></code></pre></div></div>
<h4 id="setint-index-e-elementåœ¨å®¹å™¨çš„æŒ‡å®šä½ç½®è®¾ç½®æŒ‡å®šçš„å€¼">set(int index, E element)(åœ¨å®¹å™¨çš„æŒ‡å®šä½ç½®è®¾ç½®æŒ‡å®šçš„å€¼)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre> /**
  * 1 æ£€æŸ¥ç´¢å¼•ä½ç½®æ˜¯å¦åˆæ³•
  * 2 å°†è¯¥ä½ç½®æ—§çš„å€¼èµ‹å€¼ç»™ä¸´æ—¶çš„å˜é‡oldValue
  * 3 å°†æ–°å€¼å­˜æ”¾åˆ°è¯¥ç´¢å¼•ä½ç½®
  * 4 è¿”å›è¢«åˆ é™¤çš„å€¼
  */

 public E set(int index, E element) {
        rangeCheck(index);

        E oldValue = elementData(index);
        elementData[index] = element;
        return oldValue;
    }

</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>get(int index)è·å–æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ 
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre> public E get(int index) {
      rangeCheck(index);

      return elementData(index);
  }
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h4 id="clear-æ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ">clear() æ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>    public void clear() {
        modCount++;

        // clear to let GC do its work
        for (int i = 0; i &lt; size; i++)
            elementData[i] = null;

        size = 0;
    }

</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="addallcollection-extends-e-cå°†é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°å½“å‰é›†åˆçš„æœ«å°¾">addAll(Collection&lt;? extends E&gt; c)å°†é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°å½“å‰é›†åˆçš„æœ«å°¾ã€‚</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>       /**
        * 1. å°†ç›®æ ‡é›†åˆè½¬æ¢ä¸ºæ•°ç»„
        * 2. ç¡®ä¿é›†åˆé•¿åº¦
        * 3. å°†ç›®æ ‡æ•°ç»„å†…å®¹æ‹·è´åˆ°å½“å‰æ•°ç»„çš„æœ€å
        * 4. æ›´æ–°é›†åˆçš„å®¹é‡
        * 5. æ ¹æ®ç›®æ ‡æ•°ç»„çš„å®¹é‡è¿”å›booleanåˆ¤æ–­æ˜¯å¦æˆåŠŸã€‚
        */
       
       public boolean addAll(Collection&lt;? extends E&gt; c) {
        Object[] a = c.toArray();
        int numNew = a.length;
        ensureCapacityInternal(size + numNew);  // Increments modCount
        System.arraycopy(a, 0, elementData, size, numNew);
        size += numNew;
        return numNew != 0;
    }

</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="addallint-index-collection-extends-e-cå°†ç›®æ ‡é›†åˆçš„å…ƒç´ ä»æŒ‡å®šç´¢å¼•ä½ç½®å¼€å§‹æ·»åŠ åˆ°å½“å‰é›†åˆä¸­å¹¶ä¸”å°†åŸæœ¬ä½ç½®çš„å…ƒç´ å‘åç§»åŠ¨ç›®æ ‡é›†åˆé•¿åº¦çš„ä½ç½®">addAll(int index, Collection&lt;? extends E&gt; c)å°†ç›®æ ‡é›†åˆçš„å…ƒç´ ä»æŒ‡å®šç´¢å¼•ä½ç½®å¼€å§‹æ·»åŠ åˆ°å½“å‰é›†åˆä¸­ï¼Œå¹¶ä¸”å°†åŸæœ¬ä½ç½®çš„å…ƒç´ å‘åç§»åŠ¨ç›®æ ‡é›†åˆé•¿åº¦çš„ä½ç½®</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>       /**
        * 1. å°†ç›®æ ‡é›†åˆè½¬æ¢ä¸ºæ•°ç»„
        * 2. ç¡®ä¿é›†åˆé•¿åº¦
        * 3. è®¡ç®—å…ƒç´ éœ€è¦ç§»åŠ¨çš„é•¿åº¦ï¼Œç„¶åå°†åŸæœ¬ä½ç½®çš„å…ƒç´ å‘åç§»åŠ¨æŒ‡å®šé•¿åº¦ã€‚
        * 4. å°†ç›®æ ‡æ•°ç»„å¤åˆ¶åˆ°indexä½ç½®
        * 5. æ ¹æ®ç›®æ ‡æ•°ç»„çš„å®¹é‡è¿”å›booleanåˆ¤æ–­æ˜¯å¦æˆåŠŸã€‚
        *
        */
       public boolean addAll(int index, Collection&lt;? extends E&gt; c) {
            rangeCheckForAdd(index);
    
            Object[] a = c.toArray();
            int numNew = a.length;
            ensureCapacityInternal(size + numNew);  // Increments modCount
    
            int numMoved = size - index;
            if (numMoved &gt; 0)
                System.arraycopy(elementData, index, elementData, index + numNew,
                                 numMoved);
    
            System.arraycopy(a, 0, elementData, index, numNew);
            size += numNew;
            return numNew != 0;
        }
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="removeallcollection-cåˆ é™¤å½“å‰é›†åˆå’Œç›®æ ‡é›†åˆä¸­å…ƒç´ ç›¸ç­‰çš„å€¼">removeAll(Collection&lt;?&gt; c)åˆ é™¤å½“å‰é›†åˆå’Œç›®æ ‡é›†åˆä¸­å…ƒç´ ç›¸ç­‰çš„å€¼ã€‚</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre>        public boolean removeAll(Collection&lt;?&gt; c) {
            Objects.requireNonNull(c);
            return batchRemove(c, false);
        }
        
        
        private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) {
            final Object[] elementData = this.elementData;
            int r = 0, w = 0;
            boolean modified = false;
            try {
                for (; r &lt; size; r++)
                    //å¦‚æœå½“å‰é›†åˆä¸­ä¸å­˜åœ¨ç›®æ ‡é›†åˆä¸­çš„å€¼ï¼Œå°±å°†æ”¹å…ƒç´ å­˜æ”¾åˆ°å½“å‰æ•°ç»„çš„wç´¢å¼•å¤„
                    if (c.contains(elementData[r]) == complement)
                        elementData[w++] = elementData[r];
            } finally {
                // Preserve behavioral compatibility with AbstractCollection,
                // even if c.contains() throws.
                
                // å½“c.contains() æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸çš„æ—¶å€™å°†råçš„å…ƒç´ é™„åŠ åˆ°wä½ç½®åé¢
                // åœ¨æŸç§æƒ…å†µä¸‹ c.contain()å¯èƒ½ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆçš„å¼‚å¸¸ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œ
                //å¯¹äºç©ºæŒ‡é’ˆä¸‹é¢çš„ä¾‹å­å°±ä¼šå‡ºç°
                // public static boolean doesContain(Integer i) {
                //   return array.contains(Integer.toString(i));
                //   }
                //
                //    public static void main(String[] args) {
                //    System.out.println(doesContain(null));
                //  }
                
                if (r != size) {
                    System.arraycopy(elementData, r,
                                     elementData, w,
                                     size - r);
                    w += size - r;
                }
                
                //å°†å‰©ä½™å…ƒç´ æ¸…ç©º
                if (w != size) {
                    // clear to let GC do its work
                    for (int i = w; i &lt; size; i++)
                        elementData[i] = null;
                    modCount += size - w;
                    size = w;
                    modified = true;
                }
            }
            return modified;
        }
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="retainallcollection-c-å–ç›®æ ‡é›†åˆå’Œå½“å‰é›†åˆçš„äº¤é›†">retainAll(Collection&lt;?&gt; c) å–ç›®æ ‡é›†åˆå’Œå½“å‰é›†åˆçš„äº¤é›†</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>    // æ­¤æ“ä½œå’Œremoveç›¸å å–ç›¸åŒçš„å€¼ é€šè¿‡complement=trueæ¥æ§åˆ¶
   
     public boolean retainAll(Collection&lt;?&gt; c) {
        Objects.requireNonNull(c);
        return batchRemove(c, true);
    }
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="replaceallunaryoperator-operatorå°†é›†åˆä¸­æ‰€æœ‰çš„å€¼æ›¿æ¢ä¸ºæŒ‡å®šå€¼">replaceAll(UnaryOperator<E> operator)å°†é›†åˆä¸­æ‰€æœ‰çš„å€¼æ›¿æ¢ä¸ºæŒ‡å®šå€¼</E></h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>        /**
         * UnaryOperator é€šè¿‡ä¼ å…¥å‡½æ•°æ–¹æ³•æ¥è¿›è¡Œæ›¿æ¢å€¼
         */
        @Override
        @SuppressWarnings("unchecked")
        public void replaceAll(UnaryOperator&lt;E&gt; operator) {
            Objects.requireNonNull(operator);
            final int expectedModCount = modCount;
            final int size = this.size;
            for (int i=0; modCount == expectedModCount &amp;&amp; i &lt; size; i++) {
                elementData[i] = operator.apply((E) elementData[i]);
            }
            if (modCount != expectedModCount) {
                throw new ConcurrentModificationException();
            }
            modCount++;
        }
        
        
        ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š
            List&lt;Integer&gt; list = Lists.newArrayList();
            for (int i = 0; i &lt; 10; i++) {
                list.add(i);
            }
    
            list.replaceAll(a -&gt; a + 10);
            System.out.println(list);
</pre></td></tr></tbody></table></code></pre></div></div>
:ET